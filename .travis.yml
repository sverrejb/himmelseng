language: python
python:
- '3.6'
env:
  global:
  - secure: cmS7to7bu1dMoGcpfOYAcOBeeiRUr2AyCAowsz5OOoVq32B9fPG9geyKS1MmM6hC/DG5DEeT0w8GeeZBhhNdUARi5V2cFmDtlzQxDfz/dyvZ7AqmSrSNdi8jdm9UT+za+sWkDuH1IOSywPabvcfNeIIQTKC/VUNJ53BSkacG7JRuT6vcSseqo7wYJdmEJvyf66HxmNg4XlQUz5X9TH6/b9ASEn3QpSg3cQYh7er4MoLSuEmqAIKcfEX/9ijRv05qYS+UkRs7AGAy0YZOFw1K3Byci7mNUlCt5WBZukN+NO0ocThhSFHlN6RiO8F/FkJi52EyY9L8Cd+hORE7b5MEpWm42JgoM9xiodQ/kpyVqf/9Lg1QDiRpyAXD7Z1AZDnVPb92uoPG1OBhro+NJPLkIdIq5dO5zSN/pX5aERXWCdkBHsSmMDKr+LDaeE8S9Cj3znUPbh/aw5sjziHQQ4e1oE3+jRBpIpePbL2jvU806sBZeYOZ1jUzLZMPwJIWtXk628XCdYdZ5uYSuOpRl9nC3Z0dvyIQuirbWQeloichqaSB8v+35AfxW/w/MGguzymGdM5wgvIh2JygHUNf1jByELW2xXGT83uH1VVk/TPrZxrHP3Ham53/uAiH0NCiMLVrIIFJC0r1nKlGvOlixiERBu43KbI2m6qYX2SdcRJkzvE=
  - secure: cHWhmSDPcMFjEdJGi4dZ/hFjN6b1g9nbFxfBGj09X7r5bcGrPd1m7LWpfEOEoWkNodjGAW1tubBlWlUPTC+2YnblayHw2d3Z5SZP2HqNbXazEcoGWCzs9ya4/9l9ENcSdof1SIR9zUzrRXxbjf6891S/eUc8VfZlExKL3pOP0VBu7WfgGYX7u7ahIBjcjTTFTGonsHme5kSFTbsykGS4eBZN2oAXwpSM2LESM/DH70BG6AZs/wbrT6abm78N2HgQdRw4dWr0AFc3W1L/BEw4R5r44ny0EvMdp5Ngsczan25YMzQJxcorgbKgxLDLbI+u/qIDdkOfk6N0jEovIVt30es2Xq3dGvwD6qRZLjFU8OIfljAYjoFeS/bLOH4tGzWxzG3517CBe6kCGuZIGyHh/t3cXHgUbpUobCJ4gG4nmbrQ106g3TKXsg/yPXZi3iWXrlufNhujTgmLjJd73pBBeavG4TdW1cE+UGdQJHKbsvaPtdhfx5QoVqFj8LKDw9eoJmVvSsCJ+utv9ReSHbjoVrRY8VhPe77nH2qAyfU4qY2Puje7DL11QnHevkomNXEfSuzYTN2bzcF7RxsjFyCp7LwYxvUZK4kCE3zBqq/qkRpz7bn+na59QkzsvXLqsok28pxGW3K9kQytnGNtp5l7idD3tDUhqPPM1LLvlzoHg8k=
  - secure: cQqUWzBR4vioXRC+4ExFdzgolw6qy0+rqTAXdNlyuo+7RkvhIx7sxepGOk/4iZvec9cKtLzf6rzIS7Gy2NVVQzkEEpphBvepM4aywUzVLRB03SUjQpGegI6ug4ZDkB/Wilv9PG6yORLmzYx0/tDi7p9nXxhnwQFaWY2xXdvH/dgxgoWa/44BsL5WuTmaj0ypY0ClaZJaNHtqDtvUF6VQHnx4/yxp1J3L/668/wYLERJJsWfb7f7ywiE3ZmwtkQjfNK9zxDq6ccnjL/uKAnFh5rhzbRCp51Or+/DOtihFi/dCaM1+1J1GP9KmYRrlS6eXqxUF8MeMSGAfGyLJ26hU3Gu7o2qgtTr15muvkgMjtwdkDNb+ftgkWh5BJaWN+VZal+uX5kguPbIQe4Hg8obvPEhxd5FUXieBcInmaoI5PFfi/QCmM5WgQDc+7v5E1v7jz8HKNemI+5RfwULe5yIfb2DePtGR87sJy6VClJ7WgYBCEW9+KNSYoTVgnJmpjawbzR9+j2OEsPhf18QPevaXknzujcAAVPr+DXFiMt5KNznLFqaJQLqSbDPIwKzrcgSGufK1OeqjaEEQfGLvKHgVx8YGNeR36uUyib3BVJL5fgur2zQSWZ+yJMqmUseihnMVKR7uMnI9gQbCC2F6d97aNGqQcwK1QBiisZCXwXR3nrQ=
  - secure: X0sfFs92LMgjZImzrjH66GhMm+9UvjEXqUBCWY3p30fTHy9JLk/WF7s9z3Be6HXYY+Y1TI5wE1/zWxz7W6PU6Yu3aeUb0Jf3AK920/Thm6uCv5WE+RF7s5svASCoHYs22AUUUpalOT8L5ETtGF7TAisVyG5USJPOPFMOgQoyvtgYPjwe1To3IwgAVWXieNWXk1KI1S1dmROieU5BGEDjYK0okxE0km2Dz5/8I2hFQtgCit6/tOkf8G/qNjR4+yE7G0kKr6XcO2L2rnwCdkZSeGgTNF8VZQqMu/EoJv3n4hC+lPa/zRju25WNVoINvVv5J/FeQtOx8gWYfa73PfipyrxMcMrc1uoEuDF2J/Z+HDmPipmyB2zDIf0NGeWjYuiVd0fyQxvwuHqUdTZkFZABP2Fb8YDU0tVv4WYVUj4yqG2ttjsECSzdaW1WOKpXzzrllSl+otqxU5Tkvra0TbOMiOVO3U2MT5UkgLwmGm1knT3913KLkZpx95VFp+SrwHb1hxEpYcH1Utz0kCJRsIHam2dESz2bb7B27qtVztdn4rH6CUprK8LHbO/fBYcYLl7nYPtna/K2lv4uWAAUiihSDKn0n1J+UTSQazQ5EDvLOCcrULyYxcnWf7Rvx98Rr20GIZeim137tHOuM0McNG+D4q3PWOUySm4iPNQzHKoMYpc=
  - secure: N7TsUmBHNXTnTWAKS0Jmh8u+iezcgM/tI5SQ1f40KXpl/AB89KEod2yyN/WMgWExoX0bASQNpEkEvELlvDLmKdrTfOAayrscewwoI+9FRObwOK+7c36wzgzDBv3LRdV4FYxqCQAoLxEPBxmb8PN+85ksT4VU1BPvpYKax4DV4Jr6pVSUjNSbqaG/y8Yiakog2Tpi14aQd8TkOpWXImgTWQW094psJF9Z/PfuB/Q1WGbtMr4ATD+RGOChzRuZKMbd4WVbRa0E/k/bTol+7+hSmoNfpFfGMJGPBMMmmZdFtLW6lrYQvXLBzu3PYf3plgeREdXH/SJpo5t4XYZq+tU8IndmzB8h6reTEDg26LaIaORBnv8HG06teP2sqVt9MIrIs2q2RITHYokM4y9LU1bw2jc/ZbOKfbDR8fDvHA1gBWYcbDsIdzWeq+NSdQbW+TLi/HSdqV7zOLLLD2StlOY6MyVYHRC/OW1XQKjuBcjMCCCGq2DNYcdrkMu1mwrNDfHNIxkQsvsGN2h28p+XEsn6JUCAyQgaw0DNf4FrQ46/w3bYH9rrOphG3xLY6vv38CHmTcCPXiHLMNpxJ5+DI1kNDqlQpSlr8IfXvvq0nEGM8Z/L94/1g4GKgbB6Y4+evf3jMYTYc67R+tKq2zMa+nNqQPIz6IFOFTJKh6+NnXloVKQ=
services:
- docker
script: nose2
before_deploy:
- docker login --username=$DOCKER_HUB_USERNAME --password=$DOCKER_HUB_PASSWORD
- docker build -t himmelseng .
- docker tag himmelseng:latest $DOCKER_HUB_USERNAME/himmelseng:production
- docker push $DOCKER_HUB_USERNAME/himmelseng:production
- openssl aes-256-cbc -K $encrypted_76bf4cc37491_key -iv $encrypted_76bf4cc37491_iv
  -in deploy_key.enc -out ./deploy_key -d
deploy:
  provider: script
  skip_cleanup: true
  script: chmod 600 deploy_key && ssh -o StrictHostKeyChecking=no -i deploy_key $HOST_USER@$HOST_IP
    ./deploy.sh
  on:
    branch: V2_Backend
